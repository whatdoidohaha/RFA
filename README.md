# Reference-free analysis of genetic architecture

Reference-free analysis is a powerful formalism for analyzing the genetic architecture of proteins and nucleic acids. Here we provide scripts and tutorials for performing reference-free analysis on experimental data. The directory */Tutorials* provides annotated workflows and example datasets (read the section **Tutorials** below for more information). The directory */Scripts* contains the function implementations, which we recommend accessing through the annotated workflows.

## Tutorials
We provide tutorials for four workflows.

**RFA:** Here, reference-free effects on genetic score and nonspecific epistasis are jointly inferred. Any form of genotype space, including when the number of states varies among sites, is supported. We perform unregularized and regularized regression (using cross-validation to determine the optimal LASSO penalty) and build minimal reference-free models with maximal explanatory power. The joint inference of reference-free effects and nonspecific epistasis requires nonlinear regression, which makes this analysis slow. When the number of genotypes exceeds 100,000, cross-validating a second- or third-order model may take days. Furthermore, we find that the optimzer can get stuck in local optima when the fraction of genotypes in the dynamic range of measurement is very small. The next workflow illustrates an approximate optimization that is faster and more robust yet largely retains the accuracy.

**RFA-fast:** Instead of jointly inferring reference-free effects and nonspecific epistasis, this workflow asks the user to specify the nonspecific epistasis parameters and then performs generalized linear regression using the specified function as link function. The result is the best estimate of reference-free effects under the fixed shape of nonspecific epistasis. The highly optimized R package `glmnet` is used to make this workflow fast and robust. Once the reference-free effects are inferred, the nonspecific epistasis parameters can be optimized while fixing the effects; this two-step procedure can be iterated to further improve the model fit.

**RFA-binary:** Here, joint inference of reference-free effects and nonspecific epistasis is performed using scripts tailored for binary genotype spaces. When there are only two states per site, the zero-mean property of reference-free effects causes all effects in a site-combination to equal in magnitude and vary only in sign. Therefore, only one effect needs to be explicitly modeled and inferred for each site-combination. (Simplex encoding and graph Fourier transform exploit the zero-mean property to achieve this compact encoding for multiple states.) This compact encoding makes the model structure difficult to intuit; it also causes the phenotype of any genotype to depend on every model parameter and therefore the inference to be more sensitive to missing genotypes, as detailed in Fig. 1E of our paper. However, the impact on sensitivity is minor when the number of states is small and is outweighed by the computational efficiency of compact encoding.

**RFA-fast-binary:** The fast, approximate inference in **RFA-fast** is tailored for binary genotype spaces.

We use three published datasets for our tutorials. The avGFP dataset comprehensively samples a binary genotype space over 13 sites in a fluorescent protein (total 8,192 genotypes; see the notes for each dataset for citation and more detail). The phenotype is the average fluorescence at two wavelengths. The CR9114-B dataset is a near-complete sample of a binary genotype space over 16 sites in an antibody (99.7% sampling of 65,536 possible genotypes). The phenotype is the affinity towards the influenza strain B hemagglutinin; only 0.1% of genotypes have a phenotype above the lower bound of 6. The ParD3-ParE3 dataset is a near-complete sample of a genotype space over four sites in the bacterial antitoxin ParD3 (98.2% sampling of 9,360 possible genotypes). The number of states varies across sites from 6 to 12. The phenotype is the absolute fitness conferred by binding to the toxin ParE3.

## Notes on model interpretation

As with any statistical analysis, care should be taken in the interpretation of inferred model. We describe several causes of misinterpretation and suggest safeguard practices.

*Overfitting.* In the experimental datasets we have analyzed, third-order models show almost the same out-of-sample R2 in cross-validation as second-order models, indicating that third-order effects contribute negligibly to phenotype. In some datasets, however, third-order effects inferred within a third-order model are substantial, often explaining the majority of variance at the level of genetic score. This occurs because the number of parameters in the third-order model is very large and regularization is not fully sufficient to prevent overfitting; in these cases, cross-validation shows better in-sample fit than out-of-sample fit.

Several practices can safeguard against misinterpretation due to overfitting. First, overfitting should be diagnosed by comparing in-sample and out-of-sample fit in cross-validation. It is particularly helpful to plot the observed phenotype against prediction for both in-sample and out-of-sample prediction. Second, the phenotypic contribution of each order of effects should be gauged by the improvement in fit conferred by the model with and without the effects, rather than partitioning the variance in the full model. Third, higher-order effects can be modeled just for specific site-combinations where interactions are expected, rather than all site-combinations of the same order. Instead of always including all terms of the same order, our workflow provides an easy interface to choose particular desired terms. Should the need arise, we could also develop an algorithm to automatically detect significant terms among all terms of the same order.

*Inaccurate account of nonspecific epistasis.* The sigmoid link function captures the primary cause of nonspecific epistasis - phenotype bounding - but the exact curvature may not best described the particular experimental dataset. This can be diagnosed by a global nonlinearity in the plot of observed versus predicted phenotype. We have only implemented the sigmoid linnk function for modeling nonspecific epistasis but have built an easy interface to include additional link functions.

*Limited dynamic range of measurement.* Genotypes masked by the phenotype bounds provide limited information on the effects of states they contain. Precise inference of effects may not be possible if the fraction of masked genotypes is too high. For example, consider an amino acid state that is incompatible with function and causes every genotype containing that state to be at the lower phenotype bound. We can tell that the state has a strongly negative effect, but we cannot assign an exact value to its effect because any value that is sufficiently negative will imply the same phenotype. In practice, the value inferred by the model will be arbitrary or highly sensitive to the regularization strength. When the dynamic range is severely limited, only qualitative interpretation may be possible; the only solution to this problem is to widen the dynamic range of measurement.

